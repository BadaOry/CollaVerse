<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
  <mapper namespace="com.collaverse.mvc.collabo.model.dao.CollaboMapper">
  
  		<sql id="promotionListSql">
  					SELECT PMT_NO, 
  					PMT_TITLE, 
  					PMT_IMG_PATH, 
  					PMT_CONTENT, 
  					START_DATE, 
  					END_DATE, 
  					READCOUNT, 
  					C_NO
					FROM PROMOTION
  		</sql>
  		
  		
  		<resultMap type="Promotion" id="promotionListResultMap">
  		<id property="no" column="PMT_NO"/>
  		<result property="title" column="PMT_TITLE"/>
  		<result property="imgPath" column="PMT_IMG_PATH"/>
  		<result property="content" column="PMT_CONTENT"/>
  		<result property="startDate" column="START_DATE"/>
  		<result property="endDate" column="END_DATE"/>
  		<result property="readCount" column="READCOUNT"/>
  		<result property="cNo" column="C_NO"/>	  		
  		</resultMap>
  		
  		<select id="selectAll" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/>
  			 
  		</select>
  		
  		<select id="getPromotionCount" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
	
 <!-- 
   		<select id="selectAll" parameterType="String" resultType="promotionListResultMap">
  			<include refid="promotionListSql"/>
  			 
  		</select>  

 		
  		<select id="pmtMainList" parameterType="String" resultType="String">
  		SELECT PMT_TITLE,
  			   START_DATE
  			   WHERE PMT_NO = #{no}
  		</select>
  		
 
 		
  		<resultMap type="Promotion" extends="promotionListResultMap" id="promotionDetailResultMap">
  			<collection property="replies" javaType="arraylist" columnPrefix="R_" resultMap="replyResultMap"></collection>
  		</resultMap>

  		
  		<select id="findAll" parameterType="map" resultMap="promotionListResultMap">
  				<include refid="promotionListSql"/>
  				
  				<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
  		</select>

  		
  		 <select id="getPromotionCount" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
		
		
		  <select id="getPromotionList" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
		
		<select id="selectPromotionByNo" parameterType="_int" resultMap="promotionDetailResultMap">
			SELECT 	PMT_NO,
  					PMT_TITLE, 
  					PMT_IMG_PATH, 
  					PMT_CONTENT, 
  					START_DATE, 
  					END_DATE, 
  					READCOUNT, 
  					C_NO
					FROM PROMOTION
					WHERE PMT_STATUS = 'Y' AND PMT_NO = #{no}
		</select>

 
		<insert id="insertPromotion" parameterType="Promotion" useGeneratedKeys="true" keyProperty="no" keyColumn="NO">
			INSERT INTO PROMOTION (
				PMT_NO
				PMT_TITLE,
				PMT_IMG_PATH,
				PMT_CONTENT,
				PMT_STATUS,
				START_DATE,
				END_DATE,
				READCOUNT,
				C_NO
			) VALUES (
				SEQ_PROMOTION_NO.NEXTVAL,
				#{ ptmTitle },
				#{ pmtImtPath },
				#{ pmtContent },
				DEFAULT,
				#{ startDate },
				#{ endDate },
				DEFAULT,
				DEFAULT
			)
		</insert>
 -->

  </mapper>