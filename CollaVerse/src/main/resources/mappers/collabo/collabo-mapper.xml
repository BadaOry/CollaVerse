<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
  <mapper namespace="com.collaverse.mvc.collabo.model.dao.CollaboMapper">
  		<sql id="promotionListSql">
  					SELECT PMT_NO, 
  					PMT_TITLE, 
  					PMT_IMG_PATH, 
  					PMT_CONTENT, 
  					START_DATE, 
  					END_DATE, 
  					READCOUNT, 
  					C_NO,
  					HEART_HIT
					FROM PROMOTION
  		</sql>
  		
  		
  		<resultMap type="com.collaverse.mvc.collabo.model.vo.Promotion" id="promotionListResultMap">
  		<id property="no" column="PMT_NO"/>
  		<result property="title" column="PMT_TITLE"/>
  		<result property="imgPath" column="PMT_IMG_PATH"/>
  		<result property="content" column="PMT_CONTENT"/>
  		<result property="startDate" column="START_DATE"/>
  		<result property="endDate" column="END_DATE"/>
  		<result property="readCount" column="READCOUNT"/>
  		<result property="cNo" column="C_NO"/>	 
  		<result property="heartHit" column="HEART_HIT" />
  		</resultMap>
  		
  		<resultMap type="com.collaverse.mvc.collabo.model.vo.Product" id="productListResultMap">
	  		<id property="proNo" column="PRO_NO"/>
	  		<result property="proName" column="PRO_NAME"/>
	  		<result property="proPrice" column="PRO_PRICE"/>
	  		<result property="proContent" column="PRO_CONTENT"/>
	  		<result property="proQty" column="PRO_QTY"/>
	  		<result property="proImgpath" column="PRO_IMG_PATH"/>
	  		<result property="cNo" column="C_NO"/>
	  		<result property="pmtNo" column="PMT_NO"/>  		
  		</resultMap>
  		
  		<resultMap type="com.collaverse.mvc.collabo.model.vo.Heart" id="heartListResultMap">
  			<id property="heartNo" column="HEART_NO" />
  			<result property="heartPmtNo" column="HEART_PMT_NO"/>
  			<result property="heartMemNo" column="HEART_MEM_NO"/>
  			<result property="heartCheck" column="HEARTCHECK"/>
  		</resultMap>
  		
  		<select id="selectAll" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/>
  			 
  		</select>
  		
  		<select id="getPromotionCount" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
    
		
		<select id="getPromotionInfo" parameterType="_int" 
			resultMap="promotionListResultMap" resultType="com.collaverse.mvc.collabo.model.vo.Promotion">
			SELECT *
			FROM PROMOTION
			WHERE PMT_NO = #{ pmtNo }
		</select>
		
		
		<select id="getProductInfo" parameterType="_int" 
			resultMap="productListResultMap" resultType="arrayList">
			SELECT *
			FROM PRODUCT
			WHERE PMT_NO = #{ pmtNo }
		</select>
		
		
		<select id="heartCheck" parameterType="map" resultType="_int">
			SELECT COUNT(*)
			FROM HEART
			WHERE HEART_PMT_NO = #{ pmt_no }
    			AND HEART_MEM_NO = #{ heart_mem_no }
		</select>	
		
		
		<insert id="insertHeart" parameterType="map">
			INSERT INTO HEART(HEART_NO, HEART_PMT_NO, HEART_MEM_NO)
			VALUES (SEQ_H_HEART_NO.NEXTVAL, #{ pmt_no }, #{ heart_mem_no })
		</insert>
    
    
    	<update id="addHeartHit" parameterType="_int">
	    	UPDATE PROMOTION 
			SET HEART_HIT = HEART_HIT + 1
			WHERE PMT_NO = #{ pmt_no }
    	</update>
    	
    	
    	<update id="updateHeartCheck" parameterType="map">
	    	UPDATE HEART
			SET HEARTCHECK = 1
			WHERE HEART_PMT_NO = #{ pmt_no }
			    AND HEART_MEM_NO = #{ heart_mem_no }
    	</update>
    
    
  		<update id="updateHeartCheckCancel" parameterType="map">
  			UPDATE HEART
			SET HEARTCHECK = 0
			WHERE HEART_PMT_NO = #{ pmt_no }
			    AND HEART_MEM_NO = #{ heart_mem_no }
  		</update>
  		
  		
  		<update id="minusHeartHit" parameterType="_int">
	    	UPDATE PROMOTION 
			SET HEART_HIT = HEART_HIT - 1
			WHERE PMT_NO = #{ pmt_no }
    	</update>
    	
    	
    	<delete id="deleteHeart" parameterType="map">
    		DELETE FROM HEART 
			WHERE HEART_PMT_NO = #{ pmt_no }
			    AND HEART_MEM_NO = #{ heart_mem_no }
    	</delete>
    	
  		
  		<select id="selectLiving" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/> 			 
  			 WHERE C_NO = '1' 
  		</select>
    
    
  		<select id="selectCulture" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/>
  			 WHERE C_NO = '2' 
  		</select>
  		
    
  		<select id="selectFood" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/>	 
  			 WHERE C_NO = '3' 
  		</select>   		  		

    
  		<select id="selectTech" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/> 			 
  			 WHERE C_NO = '4' 
  		</select> 
  		
  		<select id="selectFashion" parameterType="map" resultMap="promotionListResultMap">
  			<include refid="promotionListSql"/>  			 
  			 WHERE C_NO = '5' 
  		</select> 

 <!-- 
   		<select id="selectAll" parameterType="String" resultType="promotionListResultMap">
  			<include refid="promotionListSql"/>
  			 
  		</select>  

 		
  		<select id="pmtMainList" parameterType="String" resultType="String">
  		SELECT PMT_TITLE,
  			   START_DATE
  			   WHERE PMT_NO = #{no}
  		</select>
  		
 
 		
  		<resultMap type="Promotion" extends="promotionListResultMap" id="promotionDetailResultMap">
  			<collection property="replies" javaType="arraylist" columnPrefix="R_" resultMap="replyResultMap"></collection>
  		</resultMap>

  		
  		<select id="findAll" parameterType="map" resultMap="promotionListResultMap">
  				<include refid="promotionListSql"/>
  				
  				<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
  		</select>

  		
  		 <select id="getPromotionCount" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
		
		
		  <select id="getPromotionList" parameterType="map" resultType="_int">
			SELECT COUNT(*) 
			FROM PROMOTION
			WHERE PMT_STATUS = 'Y'
			<choose>
					<when test="title != null">
							AND PMT_TITLE LIKE '%' || #{title} || '%'
					</when>
					<when test="content != null">
							AND PMT_CONTENT LIKE '%' || #{content} || '%'
					</when>
			</choose>
		</select>
		
		<select id="selectPromotionByNo" parameterType="_int" resultMap="promotionDetailResultMap">
			SELECT 	PMT_NO,
  					PMT_TITLE, 
  					PMT_IMG_PATH, 
  					PMT_CONTENT, 
  					START_DATE, 
  					END_DATE, 
  					READCOUNT, 
  					C_NO
					FROM PROMOTION
					WHERE PMT_STATUS = 'Y' AND PMT_NO = #{no}
		</select>

		<insert id="insertPromotion" parameterType="Promotion" useGeneratedKeys="true" keyProperty="no" keyColumn="NO">
			INSERT INTO PROMOTION (
				PMT_NO
				PMT_TITLE,
				PMT_IMG_PATH,
				PMT_CONTENT,
				PMT_STATUS,
				START_DATE,
				END_DATE,
				READCOUNT,
				C_NO
			) VALUES (
				SEQ_PROMOTION_NO.NEXTVAL,
				#{ ptmTitle },
				#{ pmtImtPath },
				#{ pmtContent },
				DEFAULT,
				#{ startDate },
				#{ endDate },
				DEFAULT,
				DEFAULT
			)
		</insert>
 -->

  </mapper>