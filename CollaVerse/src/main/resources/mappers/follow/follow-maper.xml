<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  


<mapper namespace="com.collaverse.mvc.follow.model.dao.FollowMapper">

	<resultMap type="com.collaverse.mvc.follow.model.vo.Follower" id="FollowerResultMap">
		<id property="followerNo" column="FOLLOWER_NO"/>
		<result property="toMemNo" column="TO_MEM_NO"/>
		<result property="toMemNick" column="TO_MEM_NICK"/>
		<result property="fromMemNo" column="FROM_MEM_NO"/>
		<result property="fromMemNick" column="FROM_MEM_NICK"/>
		<result property="followerCreateDate" column="FOLLOWER_CREATE_DATE"/>
	</resultMap>
	
	<resultMap type="com.collaverse.mvc.follow.model.vo.Following" id="FollowingResultMap">
		<id property="followingNo" column="FOLLOWING_NO"/>
		<result property="fromMemNo" column="FROM_MEM_NO"/>
		<result property="fromMemNick" column="FROM_MEM_NICK"/>
		<result property="toMemNo" column="TO_MEM_NO"/>
		<result property="toMemNick" column="TO_MEM_NICK"/>
		<result property="followingCreateDate" column="FOLLOWING_CREATE_DATE"/>
	</resultMap>


	<resultMap type="com.collaverse.mvc.follow.model.vo.Follower" id="FollowerMap">
		<id property="followerNo" column="FOLLOWER_NO"/>
		<result property="toMemNo" column="TO_MEM_NO"/>
		<result property="toMemNick" column="NICKNAME"/>
		<result property="toMemId" column="ID"/>
		<result property="fromMemNo" column="FROM_MEM_NO"/>
		<result property="followerCreateDate" column="FOLLOWER_CREATE_DATE"/>
		<!-- 나중에 프로필 이미지도 추가해야함 -->
	</resultMap>
	
		<resultMap type="com.collaverse.mvc.follow.model.vo.Following" id="FollowingMap">
		<id property="followingNo" column="FOLLOWING_NO"/>
		<result property="fromMemNo" column="FROM_MEM_NO"/>
		<result property="toMemNo" column="TO_MEM_NO"/>
		<result property="toMemNick" column="NICKNAME"/>
		<result property="toMemId" column="ID"/>
		<result property="followingCreateDate" column="FOLLOWING_CREATE_DATE"/>
		<!-- 나중에 프로필 이미지도 추가해야함 -->
	</resultMap>
	
	
	<select id="getFollowerList" parameterType="_int" resultType="arrayList" 
		resultMap="FollowerMap">
		SELECT F.FOLLOWER_NO, F.TO_MEM_NO, F.TO_MEM_NO, M.NICKNAME, M.ID,
			F.FROM_MEM_NO, F.FOLLOWER_CREATE_DATE <!-- 나중에 프로필 이미지도 추가해야함 -->
		FROM FOLLOWER F
		JOIN MEMBER M ON(M.MEMBER_NO = F.FROM_MEM_NO)
		WHERE F.FROM_MEM_NO IN (SELECT F.FROM_MEM_NO
		                        FROM FOLLOWER F
		                        JOIN MEMBER M ON(M.MEMBER_NO = F.TO_MEM_NO)
		                        WHERE F.TO_MEM_NO = #{ toMemNo })
			AND F.TO_MEM_NO = #{ toMemNo }	
		ORDER BY FOLLOWER_CREATE_DATE DESC
	</select>
	
	
	<select id="countFollower" parameterType="_int" resultType="_int">
		SELECT COUNT(*)
		FROM FOLLOWER
		WHERE TO_MEM_NO = #{ toMemNo }
	</select>
	
	
	<select id="getFollowingList" parameterType="_int" resultType="arrayList" 
		resultMap="FollowingMap">
		SELECT F.FOLLOWING_NO, F.TO_MEM_NO, M.NICKNAME, M.ID,
			F.FROM_MEM_NO, F.FOLLOWING_CREATE_DATE <!-- 나중에 프로필 이미지도 추가해야함 -->
		FROM FOLLOWING F
		JOIN MEMBER M ON (F.TO_MEM_NO = M.MEMBER_NO)
		WHERE F.TO_MEM_NO IN (SELECT F.TO_MEM_NO
		                        FROM FOLLOWING F
		                        JOIN MEMBER M ON(M.MEMBER_NO = F.TO_MEM_NO)
		                        WHERE F.FROM_MEM_NO = #{ fromMemNo } ) 
		    AND F.FROM_MEM_NO = #{ fromMemNo }
		ORDER BY F.FOLLOWING_CREATE_DATE DESC
	</select>


	<select id="countFollowing" parameterType="_int" resultType="_int">
		SELECT COUNT(*)
		FROM FOLLOWING
		WHERE FROM_MEM_NO = #{ fromMemNo }
	</select>
	

	<insert id="insertFollower" parameterType="map">
		INSERT INTO FOLLOWER (
			FOLLOWER_NO, TO_MEM_NO, FROM_MEM_NO, FOLLOWER_CREATE_DATE, FOLLOWERCHECK)
		VALUES (
			SEQ_FOLLOWER_NO.NEXTVAL, #{ toMemNo }, #{ fromMemNo }, DEFAULT, 1)
	</insert>
	
	
	<insert id="insertFollowing" parameterType="map">
		INSERT INTO FOLLOWING ( 
			FOLLOWING_NO, FROM_MEM_NO, TO_MEM_NO, FOLLOWING_CREATE_DATE, FOLLOWINGCHECK)
		VALUES (
			SEQ_FOLLOWING_NO.NEXTVAL, #{ fromMemNo }, #{ toMemNo }, DEFAULT, 1)
	</insert>
	
	
	<delete id="deleteFollower" parameterType="map">
		DELETE FROM FOLLOWER
		WHERE  TO_MEM_NO = #{ toMemNo }
		    AND FROM_MEM_NO = #{ fromMemNo }
	</delete>
	
	<delete id="deleteFollowing" parameterType="map">
		DELETE FROM FOLLOWING 
		WHERE FROM_MEM_NO =  #{ fromMemNo }
		    AND TO_MEM_NO = #{ toMemNo }
	</delete>
	
</mapper>
